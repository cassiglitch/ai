<!DOCTYPE html>
<html>
<head>
	<title>Isogle - Search, AI, And Content Generation </title>
	<style>
		#search-container {
			margin: 20px;
		}

		#search-input {
			width: 100%;
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		#search-results {
			margin-top: 10px;
		}

		#chat-container {
			margin: 20px;
		}

		#chat-output {
			height: 200px;
			overflow-y: scroll;
			border: 1px solid #ccc;
			padding: 10px;
		}

		#chat-form {
			display: flex;
			margin-top: 10px;
		}

		#user-input {
			flex: 1;
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		#chat-form button {
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: none;
			background-color: #4CAF50;
			color: #fff;
			margin-left: 10px;
		}
	</style>
</head>
<body>
	<div id="search-container">
		<input type="text" id="search-input" placeholder="Search...">
		<div id="search-results"></div>
	</div>

	<div id="chat-container">
		<div id="chat-output"></div>
		<form id="chat-form">
			<input type="text" id="user-input" placeholder="Type your message...">
			<button type="submit">Send</button>
		</form>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.8.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@4.0.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/deepai/dist/deepai.min.js"></script>

	<script>
		const apiKey = 'AIzaSyAwydGicPoEr05z1a1b6W06V2Wzl-_NVxo';
		const searchEngineId = '718cd7b701a714611';
		const searchInput = document.getElementById('search-input');
		const searchResults = document.getElementById('search-results');
		const chatOutput = document.getElementById('chat-output');
		const userInput = document.getElementById('user-input');
		const deepaiApiKey = '9b3ba361-5ed2-466b-a831-5f9a722bc612';

		async function generateChatbotResponse(inputText) {
			try {
				const model = await use.load();
				const embeddings = await model.embed([inputText]);

				if (inputText.toLowerCase().startsWith('search')) {
					const query = inputText.substring(7);
					const url = `https://www.googleapis.com/customsearch/v1?key=${apiKey}&cx=${searchEngineId}&q=${query}`;

					try {
						const response = await fetch(url);
						const data = await response.json();
						const items = data.items;

						searchResults.innerHTML = '';

						for (const item of items) {
							const title = item.title;
							const link = item.link;
							const snippet = item.snippet;

							const resultDiv = document.createElement('div');
							resultDiv.innerHTML = `<h3><a href="${link}">${title}</a></h3><p>${snippet}</p>`;
							searchResults.appendChild(resultDiv);
						}
					} catch (err) {
						console.error(err);
						searchResults.innerHTML = '<p>There was an error retrieving search results. Please try again later.</p>';
					}

					chatOutput.innerHTML += `<p>Here are the search results for "${query}":</p>`;
				} else if (inputText.toLowerCase().startsWith('generate image')) {
					const style = inputText.substring(15);
					const response = await deepai.callStandardApi('image-generator', { model: 'text2img', text: style }, deepaiApiKey);
					const imageUrl = response.output_url;

					chatOutput.innerHTML += `<p>Here's an image generated from the text "${style}":</p><img src="${imageUrl}" alt="Generated image">`;
				} else if (inputText.toLowerCase().startsWith('summarize video')) {
					const videoUrl = inputText.substring(16);
					const response = await deepai.callStandardApi('video-summarization', { url: videoUrl }, deepaiApiKey);
					const summaryUrl = response.output_url;

					chatOutput.innerHTML += `<p>Here's a summary of the video at "${videoUrl}":</p><video controls><source src="${summaryUrl}" type="video/mp4"></video>`;
				} else if (inputText.toLowerCase().startsWith('classify video')) {
					const videoUrl = inputText.substring(15);
					const response = await deepai.callStandardApi('video-classifier', { url: videoUrl }, deepaiApiKey);
					const classes = response.output.classes;

					let classList = '';
					for (const cls of classes) {
						classList += `<li>${cls.class_name}: ${cls.confidence.toFixed(2)}</li>`;
					}

					chatOutput.innerHTML += `<p>Here are the classifications for the video at "${videoUrl}":</p><ul>${classList}</ul>`;
				} else {
					const response = await fetch('/chatbot', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({ inputText })
					});

					const data = await response.json();
					const chatbotResponse = data.chatbotResponse;

					chatOutput.innerHTML += `<p><strong>You:</strong> ${inputText}</p><p><strong>Chatbot:</strong> ${chatbotResponse}</p>`;
				}

				chatOutput.scrollTop = chatOutput.scrollHeight;
			} catch (err) {
				console.error(err);
				chatOutput.innerHTML += '<p>There was an error processing your request. Please try again later.</p>';
				chatOutput.scrollTop = chatOutput.scrollHeight;
			}
		}

		document.getElementById('chat-form').addEventListener('submit', (e) => {
			e.preventDefault();
			const inputText = userInput.value.trim();

			if (inputText !== '') {
				generateChatbotResponse(inputText);
				userInput.value = '';
			}
		});

		searchInput.addEventListener('input', async () => {
			const query = searchInput.value.trim();

			if (query !== '') {
				const url = `https://www.googleapis.com/customsearch/v1?key=${apiKey}&cx=${searchEngineId}&q=${query}&fields=items(title,link,snippet)`;

				try {
					const response = await fetch(url);
					const data = await response.json();
					const items = data.items;

					searchResults.innerHTML = '';

					for (const item of items) {
						const title = item.title;
						const link = item.link;
						const snippet = item.snippet;

						const resultDiv = document.createElement('div');
						resultDiv.innerHTML = `<h3><a href="${link}">${title}</a></h3><p>${snippet}</p>`;
						searchResults.appendChild(resultDiv);
					}
				} catch (err) {
					console.error(err);
					searchResults.innerHTML = '<p>There was an error retrieving search results. Please try again later.</p>';
				}
			} else {
				searchResults.innerHTML = '';
			}
		});
	</script>
</body>
</html>
