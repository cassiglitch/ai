<!DOCTYPE html>
<html>
<head>
	<title>Isogle - Search and AI</title>
	<style>
		#search-container {
			margin: 20px;
		}

		#search-input {
			width: 100%;
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		#search-results {
			margin-top: 10px;
		}

		#chat-container {
			margin: 20px;
		}

		#chat-output {
			height: 200px;
			overflow-y: scroll;
			border: 1px solid #ccc;
			padding: 10px;
		}

		#chat-form {
			display: flex;
			margin-top: 10px;
		}

		#user-input {
			flex: 1;
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		#chat-form button {
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: none;
			background-color: #4CAF50;
			color: #fff;
			margin-left: 10px;
		}
	</style>
</head>
<body>
	<div id="search-container">
		<input type="text" id="search-input" placeholder="Search...">
		<div id="search-results"></div>
	</div>

	<div id="chat-container">
		<div id="chat-output"></div>
		<form id="chat-form">
			<input type="text" id="user-input" placeholder="Type your message...">
			<button type="submit">Send</button>
		</form>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.8.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@4.0.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/deepai/dist/deepai.min.js"></script>
	<script>
		const deepaiApiKey = '9b3ba361-5ed2-466b-a831-5f9a722bc612';
		const apiKey = 'AIzaSyAwydGicPoEr05z1a1b6W06V2Wzl-_NVxo';
		const searchEngineId = '718cd7b701a714611';
		const searchInput = document.getElementById('search-input');
		const searchResults = document.getElementById('search-results');
		const chatOutput = document.getElementById('chat-output');
		const userInput = document.getElementById('user-input');

		async function generateChatbotResponse(inputText) {
			try {
				const model = await use.load();
				const embeddings = await model.embed([inputText]);

				// Call DeepAI API using the callStandardApi method
				const response = await deepai.callStandardApi('text-generator', { prompt: embeddings.arraySync() }, deepaiApiKey);
				const generatedText = response.output;
				chatOutput.innerHTML += `<p>${generatedText}</p>`;

				// Call DeepAI API using the callApi method with fetch
				const apiEndpoint = 'https://api.deepai.org/api/text-generator';
				const response2 = await fetch(apiEndpoint, {
					method: 'POST',
					headers: { 'Api-Key': deepaiApiKey },
					body: JSON.stringify({ text: inputText })
				});
				const data = await response2.json();
				const generatedText2 = data.output;
				chatOutput.innerHTML += `<p>${generatedText2}</p>`;

				// Call DeepAI API using the callApi method with XMLHttpRequest
				const xhr = new XMLHttpRequest();
				xhr.open('POST', apiEndpoint);
				xhr.setRequestHeader('Api-Key', deepaiApiKey);
				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.onload = function() {
					const data = JSON.parse(xhr.responseText);
					const generatedText3 = data.output;
					chatOutput.innerHTML += `<p>${generatedText3}</p>`;
				};
				xhr.onerror = function() {
					chatOutput.innerHTML += '<p>There was an error generating the chatbot response using XMLHttpRequest. Please try again later.</p>';
				};
				xhr.send(JSON.stringify({ text: inputText }));

			} catch (err) {
				console.error(err);
				chatOutput.innerHTML += '<p>There was an error generating the chatbot response. Please try again later.</p>';
			}
		}

		document.getElementById('chat-form').addEventListener('submit', async (event) => {
			event.preventDefault();

			const inputText = userInput.value;
			chatOutput.innerHTML += `<p>You: ${inputText}</p>`;
			await generateChatbotResponse(inputText);
			userInput.value = '';
		});

		// Example of handling authentication errors when calling the DeepAI API using the callApi method
		deepai.callApi('text-generator', { prompt: 'Hello, World!' }, 'invalidApiKey')
			.then(response => {
				console.log(response);
			})
			.catch(err => {
				if (err.status === 401) {
					console.error('Invalid API key.');
				} else {
					console.error('There was an error calling the DeepAI API.');
				}
			});

		// Example of handling rate limit errors when calling the DeepAI API using the callApi method
		for (let i = 0; i < 10; i++) {
			deepai.callApi('text-generator', { prompt: 'Hello, World!' }, deepaiApiKey)
				.then(response => {
					console.log(response);
				})
				.catch(err => {
					if (err.status === 429) {
						console.error('Rate limit exceeded. Please try again later.');
					} else {
						console.error('There was an error calling the DeepAI API.');
					}
				});
		}
	</script>
</body>
</html>
