<!DOCTYPE html>
<html>
<head>
	<title>Isogle - Search and AI</title>
	<style>
		#search-container {
			margin: 20px;
		}

		#search-input {
			width: 100%;
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		#search-results {
			margin-top: 10px;
		}

		#chat-container {
			margin: 20px;
		}

		#chat-output {
			height: 200px;
			overflow-y: scroll;
			border: 1px solid #ccc;
			padding: 10px;
		}

		#chat-form {
			display: flex;
			margin-top: 10px;
		}

		#user-input {
			flex: 1;
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ccc;
		}

		#chat-form button {
			font-size: 16px;
			padding: 10px;
			border-radius: 5px;
			border: none;
			background-color: #4CAF50;
			color: #fff;
			margin-left: 10px;
		}
	</style>
</head>
<body>
	<div id="search-container">
		<input type="text" id="search-input" placeholder="Search...">
		<div id="search-results"></div>
	</div>

	<div id="chat-container">
		<div id="chat-output"></div>
		<form id="chat-form">
			<input type="text" id="user-input" placeholder="Type your message...">
			<button type="submit">Send</button>
		</form>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.8.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@4.0.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/deepai/dist/deepai.min.js"></script>
	<script>
		const deepaiApiKey = '9b3ba361-5ed2-466b-a831-5f9a722bc612';
		const apiKey = 'AIzaSyAwydGicPoEr05z1a1b6W06V2Wzl-_NVxo';
		const searchEngineId = '718cd7b701a714611';
		const searchInput = document.getElementById('search-input');
		const searchResults = document.getElementById('search-results');
		const chatOutput = document.getElementById('chat-output');
		const userInput = document.getElementById('user-input');

		async function generateChatbotResponse(inputText) {
			try {
				const model = await use.load();
				const embeddings = await model.embed([inputText]);
				const response = await deepai.callStandardApi('text-generator', { prompt: embeddings.arraySync() }, deepaiApiKey);
				const generatedText = response.output;

				if (inputText.toLowerCase().startsWith('search')) {
					const query = inputText.substring(7);
					const url = `https://www.googleapis.com/customsearch/v1?key=${apiKey}&cx=${searchEngineId}&q=${query}`;

					try {
						const response = await fetch(url);
						const data = await response.json();
						const items = data.items;

						searchResults.innerHTML = '';

						for (const item of items) {
							const title = item.title;
							const link = item.link;
							const snippet = item.snippet;

							const resultDiv = document.createElement('div');
							resultDiv.innerHTML = `<h3><a href="${link}">${title}</a></h3><p>${snippet}</p>`;
							searchResults.appendChild(resultDiv);
						}
					} catch (err) {
						console.error(err);
						searchResults.innerHTML = '<p>There was an error retrieving search results. Please try again later.</p>';
					}

					chatOutput.innerHTML += `<p>Here are the search results for "${query}":</p>`;
				} else {
					chatOutput.innerHTML += `<p>${generatedText}</p>`;
				}
			} catch (err) {
				console.error(err);
				chatOutput.innerHTML += '<p>There was an error generating the chatbot response. Please try again later.</p>';
			}
		}

		document.getElementById('chat-form').addEventListener('submit', async (event) => {
			event.preventDefault();

			const inputText = userInput.value;
			chatOutput.innerHTML += `<p>You: ${inputText}</p>`;
			await generateChatbotResponse(inputText);

			userInput.value = '';
		});
	</script>
</body>
</html>
